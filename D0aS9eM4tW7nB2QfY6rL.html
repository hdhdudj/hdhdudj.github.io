<!doctype html>
<meta charset="utf-8">
<title>마니또 짝 뽑기</title>
<style>body{font-family:sans-serif;max-width:600px;margin:40px auto}</style>
<h1>마니또 짝 뽑기</h1>
<label>내 이름: <input id="myName" placeholder="이름 입력"></label>
<br><br>
<label>내 UID(임시 식별자): <input id="uid" placeholder="예: 이메일/사번/난수"></label>
<p style="color:#666">※ 같은 사람이 여러 번 누르는 걸 막으려면 UID는 고정된 식별자를 쓰세요.</p>
<button id="btn">짝 뽑기</button>
<pre id="out"></pre>

<script>
const WEBAPP_BASE = 'https://script.google.com/macros/s/AKfycby-qSeiXWVD1GesvPkF8aBNsktzQ-MNzadA9Ztz4JMr8iVW-L0iWWYaoJOd1i8_-Bfx/exec';

function onClaim(resp){ // JSONP 콜백
  const out = document.getElementById('out');
  if(!resp || !resp.ok){ out.textContent = '오류: '+(resp && resp.error); return; }
  if(resp.already){
    out.textContent = `이미 배정됨: ${resp.assigned}`;
  }else{
    out.textContent = `당신의 마니또는: ${resp.assigned}`;
  }
}

document.getElementById('btn').onclick = () => {
  const myName = document.getElementById('myName').value.trim();
  const uid = document.getElementById('uid').value.trim();
  if(!myName || !uid){ alert('이름과 UID를 입력하세요'); return; }
  // JSONP 호출: <script src="...&callback=onClaim">
  const s = document.createElement('script');
  const url = `${WEBAPP_BASE}?action=claim&myName=${encodeURIComponent(myName)}&uid=${encodeURIComponent(uid)}&callback=onClaim`;
  s.src = url;
  document.body.appendChild(s);
};
</script>
